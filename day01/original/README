My original solution. It works, but
later I changed some parts of it.
